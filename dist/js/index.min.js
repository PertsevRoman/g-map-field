!function t(e,n,i){function r(s,o){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return r(n?n:t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=t("./lib/path-generator"),a=t("./lib/map"),s=t("./lib/renderer"),o=i(s),u=t("./lib/path"),l="path-input";document.addEventListener("DOMContentLoaded",function(){var t=document.getElementsByTagName(l)[0];if(null==t)return void console.log("Component tag not founded");var e=t.getAttribute("template"),n=t.getAttribute("field-value"),i=t.getAttribute("field-name"),s=t.getAttribute("icons-resource");$.get(s,function(t){$.get(e,function(e){try{var s=Vue.extend({template:e,mounted:function(){this.init(),this.fieldName=i,n?this.beginPath(n):this.beginPath()},data:function(){return{pathGenerator:null,map:null,currentPath:new u.Path([]),renderer:null,inEdit:!0,fieldName:""}},computed:{icons:function(){return t}},methods:{beginPath:function(e){this.currentPath&&this.currentPath.clear(),this.pathGenerator.defaultIcon=t[0].icon,this.pathGenerator.start(this.currentPath,e)},finishPath:function(){this.pathGenerator.finish()},toTop:function(t){this.currentPath.indexDispose(t,-1)},toDown:function(t){this.currentPath.indexDispose(t,1)},remove:function(t){this.currentPath.indexRemove(t)},center:function(t){var e=t.latLng;this.map.map.setCenter(e)},clearPath:function(){this.currentPath.clear()},setAhead:function(t,e){t.setAhead(e),this.renderer.render(this.currentPath)},init:function(){var t=this.$el.querySelector(".g-maps");this.map=new a.GMap(t),this.pathGenerator=new r.PathGenerator(this.map),this.renderer=new o.default(this.map),this.currentPath.addUpdateListener(function(){this.renderer.render(this.currentPath),this.$forceUpdate()}.bind(this)),this.pathGenerator.appendAddListener(function(){var t=this.currentPath.size;setTimeout(function(){var e='input[date-time="dt-'+(t-1)+'"]',n=$(e);n.timepicker({showMeridian:!1}).on("changeTime.timepicker",function(t){var e=t.time.value,i=n.attr("data-index");this.currentPath.pointValue(i,"time",e)}.bind(this))}.bind(this),500)}.bind(this)),google.maps.event.addListener(this.map.map,"click",function(t){var e=t.latLng;this.pathGenerator.add({position:e.toJSON()}),this.$forceUpdate()}.bind(this))}}});(new s).$mount(l)}catch(t){console.log(t),console.log("Не удается определить компонент: Vue.js не инициализирован")}})})})},{"./lib/map":3,"./lib/path":5,"./lib/path-generator":4,"./lib/renderer":6}],2:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n.MapMarker=function(){function t(e,n,r){if(i(this,t),this._time="",this._map=null,this._latLng={},this._description="",this._marker=null,this._template="content.html",this._label="",this._visible=!0,this._icon="",this._typeahead=[],!e)throw"Не определена карта";this._marker=new google.maps.Marker({map:e.map,position:n,draggable:!0}),this.map=e,r&&(this.template=r)}return r(t,[{key:"remove",value:function(){this.marker.setMap(null)}},{key:"setAhead",value:function(t){this._ahead=!0,this.description=t.name;var e={lat:t.lat,lng:t.lng};this.latLng=e}},{key:"typeahead",get:function(){return this._typeahead},set:function(t){this._typeahead=t}},{key:"draggable",get:function(){return this._marker.getDraggable()},set:function(t){this._marker.setDraggable(t)}},{key:"icon",get:function(){return this._icon},set:function(t){this._icon=t}},{key:"time",get:function(){return this._time},set:function(t){this._time=t}},{key:"map",get:function(){return this._map},set:function(t){this._map=t,this.marker.setMap(t.map)}},{key:"latLng",get:function(){return this._latLng},set:function(t){this._latLng=t,this.marker.setPosition(new google.maps.LatLng(t.lat,t.lng))}},{key:"visible",get:function(){return this._marker.getVisible()},set:function(t){this._marker.setVisible(t),this._visible=t}},{key:"description",get:function(){return this._description},set:function(t){return this._description=t,this._ahead?void(this._ahead=!1):void(""!=this._description?void 0!=dropdownResolver&&dropdownResolver(t,function(t){this._typeahead=[];for(var e in t)this._typeahead.push({name:t[e].name,lat:t[e].lat,lng:t[e].lng})}.bind(this)):this._typeahead=[])}},{key:"label",get:function(){return this._label},set:function(t){this._label=t,this._marker&&this._marker.setLabel(t)}},{key:"marker",get:function(){return this._marker}},{key:"template",get:function(){return this._template},set:function(t){this._template=t}},{key:"serial",get:function(){var t={description:this.description,position:this.marker.getPosition().toJSON(),visible:this.visible,time:this.time,icon:this.icon,draggable:this.draggable};return JSON.stringify(t)},set:function(t){var e=t.position;this.latLng=new google.maps.LatLng(e),this.description=t.description||"",t.label&&(this.label=t.label+""),"boolean"==typeof t.visible?this.visible=t.visible:this.visible=!0,this.time=t.time||"0:00",this.icon=t.icon||"",this.marker.setPosition(this.latLng),this.marker.setLabel(this.label),this.marker.setVisible(this.visible)}}]),r(t,[{key:"getPosition",value:function(){return this._marker.getPosition()}},{key:"addInfo",value:function(){var t=document.createElement("div");$(t).load("src/tpl/"+this.template);var e=new google.maps.InfoWindow({content:t});this._marker.addListener("mouseover",function(){e.open(map,this._marker)}),this._marker.addListener("mouseout",function(){e.close()})}},{key:"coordsStr",get:function(){var t=this.getPosition();return t.toString()}}]),t}()},{}],3:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n.GMap=function(){function t(e){i(this,t);var n={lat:52.61667,lng:39.6};this._map=new google.maps.Map(e,{center:n,zoom:16}),google.maps.event.trigger(this._map,"resize")}return r(t,[{key:"map",get:function(){return this._map},set:function(t){this._map=t}}]),t}()},{}],4:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PathGenerator=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=(t("./path"),t("./map-marker"));n.PathGenerator=function(){function t(e){i(this,t),this._path=[],this._counter=1,this._addedListeners=[],this._defaultIcon="",e&&(this.map=e)}return r(t,[{key:"defaultIcon",get:function(){return this._defaultIcon},set:function(t){this._defaultIcon=t}},{key:"counter",get:function(){return this._counter},set:function(t){this._counter=t}},{key:"map",get:function(){return this._map},set:function(t){this._map=t}}]),r(t,[{key:"start",value:function(t,e){if(this._path=t,e){this._path.clear();var n=JSON.parse(e),i=!0,r=!1,a=void 0;try{for(var s,o=n[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var u=s.value;this.add(u)}}catch(t){r=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}}}},{key:"finish",value:function(){this._path=null}},{key:"appendAddListener",value:function(t){this._addedListeners.push(t)}},{key:"add",value:function(t){if(this._path){var e=new a.MapMarker(this.map,t.position);t.label=this._path.markers.length+1,e.serial=t,""===e.icon&&(e.icon=this.defaultIcon),this._path.add(e);var n=!0,i=!1,r=void 0;try{for(var s,o=this._addedListeners[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;u()}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}}}}]),t}()},{"./map-marker":2,"./path":5}],5:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Path=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t("./utils");n.Path=function(){function t(e){i(this,t),this._markers=[],this._updateListeners=[],this.markers=e,this.addUpdateListener(function(){this.refreshLabels()}.bind(this))}return r(t,[{key:"pointValue",value:function(t,e,n){(0,a.assert)(t>-1&&t<this._markers.length),this._markers[t][e]=n}},{key:"indexDispose",value:function(t,e){var n=t+e;(0,a.assert)(t>-1&&t<this._markers.length),(0,a.assert)(n>-1&&n<this._markers.length);var i=this._markers[n];this._markers[n]=this._markers[t],this._markers[t]=i,this.callUpdateHandlers()}},{key:"indexRemove",value:function(t){(0,a.assert)(t>-1&&t<this._markers.length);var e=this._markers[t];e.marker.setMap(null),this._markers.splice(t,1),this.callUpdateHandlers()}},{key:"addUpdateListener",value:function(t){this._updateListeners.push(t)}},{key:"clear",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.markers[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;a.marker.setMap(null)}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}this.markers=[],this.callUpdateHandlers()}},{key:"callUpdateHandlers",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this._updateListeners[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;a()}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}},{key:"add",value:function(t){this.markers.push(t),t.marker.addListener("dragend",function(){this.callUpdateHandlers()}.bind(this)),this.markers.length>1&&this.callUpdateHandlers()}},{key:"refreshLabels",value:function(){var t=1,e=!0,n=!1,i=void 0;try{for(var r,a=this.markers[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;s.visible&&(s.label=t+"",t+=1)}}catch(t){n=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"markers",get:function(){return this._markers},set:function(t){this._markers=t}},{key:"serial",get:function(){var t=this._markers.map(function(t){return t.serial}).join(","),e="["+t+"]";return e}},{key:"coordsArray",get:function(){var t=this.markers.map(function(t){return t.getPosition()});return t}},{key:"size",get:function(){return this._markers.length}},{key:"coordsStr",get:function(){var t="",e=!0,n=!1,i=void 0;try{for(var r,a=this._markers[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;t+=s.coordsStr}}catch(t){n=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw i}}return t}}]),t}()},{"./utils":7}],6:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e){i(this,t),this._map=null,this._directionsService=new google.maps.DirectionsService,this._directionsDisplay=new google.maps.DirectionsRenderer,this.map=e}return r(t,[{key:"map",get:function(){return this._map},set:function(t){this._map=t}}]),r(t,[{key:"waypoints",value:function(t){for(var e=[],n=1;n<t.length-1;++n)e.push({location:t[n],stopover:!1});return e}},{key:"render",value:function(t){var e=t.coordsArray;if(e.length<2)return void this._directionsDisplay.setMap(null);this._directionsDisplay.setMap(this.map.map);var n=this.waypoints(e),i={origin:e[0],waypoints:n,destination:e[e.length-1],travelMode:google.maps.TravelMode.DRIVING};this._directionsService.route(i,function(t,e){e==google.maps.DirectionsStatus.OK&&this._directionsDisplay.setDirections(t)}.bind(this))}}]),t}();n.default=a},{}],7:[function(t,e,n){"use strict";function i(t,e){if(!t)throw e||"Assertion failed"}Object.defineProperty(n,"__esModule",{value:!0}),n.assert=i},{}]},{},[1]);
//# sourceMappingURL=index.min.js.map
